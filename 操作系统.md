# 操作系统

## 一、引论

### 1. 目标

- 方便性
- 有效性
- 可扩充性
- 开放性

### 2. 作用

- 用户与计算机硬件系统之间的接口、
- 计算机系统资源的管理者
- 扩充机器（OS实现了对计算机资源的抽象）

### 3. 推动操作系统发展的动力

- 提高计算机资源利用率
- 方便用户
- 器件的更新换代
- 计算机体系结构的发展
- 新的应用需求

### 4. 发展过程

- 无操作系统：人工操作/脱机IO
- 单道批处理系统++
- 多道批处理系统++
- 分时系统++
- 实时系统++
- 网络操作系统++
- 分布式操作系统++

### 5. 基本特征

- 并发：并发与并行、进程与线程
- 共享：互斥共享、同时访问
- 虚拟
- 异步

### 6. 主要功能

- 处理机管理功能：进程控制，进程同步：互斥、同步，进程通信，调度：作业、进程
- 存储器管理功能：内存分配++，内存保护，地址映射，内存扩充，虚拟存储技术
- 设备管理功能：缓冲管理，设备分配，设备处理，设备独立性和虚拟设备
- 文件管理：文件存储空间管理，目录管理，文件读写管理和保护
- 用户接口：命令，图形

## 二、进程管理

### （一）进程基本概念

1. 前趋图：有向无环DAG
2. 程序顺序执行的特征
   - 顺序性
   - 封闭性
   - 可再现行

3. 程序并发执行的特征
   - 间断性
   - 失去封闭性
   - 不可再现性

4. 进程实体的构成
   - 程序
   - 数据
   - 进程控制快PCB

5. 进程的特征
   - 动态性
   - 并发性
   - 独立性
   - 异步性
   - 结构特征

6. 进程的定义++
7. 进程与程序的区别++
8. 进程的三种基本状态，五种状态
   - 就绪
   - 执行
   - 阻塞（等待/睡眠）
   - 创建
   - 终止

9. 挂起++

### （二）进程控制

1. 原语
2. 进程图
3. 进程创建
4. 进程终止
5. 进程的阻塞与唤醒
6. 进程的挂起与激活

### （三）进程同步

1. 概念：互斥，同步，临界资源，临界区
2. 同步机制应遵循的规则
   - 空闲让进
   - 忙则等待
   - 有限等待
   - 让权等待

3. 信号量：整型，记录型，AND型，信号量集
4. 信号量操作
   - 信号量只有两种操作：赋初值，PV
   - PV成对出现
   - 尽量先执行同步P，再互斥P
   - 某些问题中，互斥问题存在，但不一定需要单独设置互斥信号量，同步信号量可能顺便解决了互斥问题

5. 进入区，临界区，退出区，剩余区
6. 生产者消费者，哲学家吃饭，读者写者
7. 管程
8. 线程





## 三、处理机调度与死锁





## 四、内存管理

### （一）存储器分层

1. 由高至低
   - 寄存器：可执行
   - 高速缓存：可执行
   - 主存储器：可执行
   - 磁盘缓存：可执行
   - 固定磁盘
   - 可移动存储介质

2. 主存储器
   - 存放运行时指令和数据
3. 寄存器
   - 处理器与主存沟通需要经过寄存器
   - 速度与处理器相同
4. 高速缓存
   - 备份主存中较常用数据
5. 磁盘缓存
   - 是主存的一部分

### （二）程序的装入和链接

- 程序装入是指将一个程序（可执行文件）从外部存储设备（如硬盘）加载到内存中的过程。

- 程序的链接是将多个目标模块（已经经过编译或汇编产生的机器语言模块）以及库函数组合成一个完整的可执行程序的过程。

1. 绝对装入方式：编译时就写死了程序中要用的内存地址
2. 可重定位装入方式：静态重定位，装入内存时立即重定位
3. 动态运行时的装入方式：运行时再重定位物理地址
4. 静态链接：运行之前
5. 装入时动态链接
6. 运行时动态链接      **基址放在PCB**



### （三）连续分配存储管理方式：程序是完整的，连续的

1. **单一连续分配**：单道系统内，整个内存的用户空间由单一程序独占
2. **固定分区分配**：多道系统，将整个用户区划分为若干固定大小区域
   - 划分分区的方法：分区大小相等，不等
   - 内存分配：分区使用表
3. **动态分区分配**：可变分区分配，无内碎片，有外碎片
   - 数据结构：空闲分区表，空闲分区链
   - 分配算法
   - 分配操作：分配内存（切割）、回收内存（几种情况）
4. 基于顺序搜索的动态分区分配算法：顺空闲链往下走
   - FF: first fit  从头按顺序走
   - NF: next fit  从上一次结尾开始
   - BF: best fit  先排序，找最接近的
   - WF: worst fit  每次都割最大的
5. 基于索引搜索的动态分区分配算法：系统太大时，顺序搜索不好用
   - quick fit: 
   - buddy system: 
   - hash: 

6. **可重定位分区分配**
   - 紧凑
   - 动态重定位
   - 动态重定位分区分配算法

### （四）对换：将内存中暂时不用的程序拿出，装入要执行的程序

1. 根据数量分类对换
   - 整体对换：处理器中级调度，“进程对换”
   - 页面（分段）对换：

2. 对换空间的管理
   - 磁盘空间分为对换区和文件区
   - 管理文件区首先为了提高文件存储空间利用率，其次是提高对文件的访问速度，采用**离散分配**
   - 管理对换区首先是提高换入换出速度，其次是提高文件存储空间利用率，采用**连续分配**
   - 数据结构
   - 分配、回收
3. 进程的换入换出

### （五）分页存储管理方式

​	*碎片内存无法使用，紧凑不可接受。分页后内存浪费少（每个程序最多一页）*

1. 概念
   - 段：整个程序的一部分
   - 页：将程序分成的小块
   - 页框：存储“页”的物理内存

2. 页表
3. 地址计算
4. 多级页表

​	*连续存储页表表项时，页表大，浪费空间。不连续存储查找慢。*多级页表类比书籍的章、节目录

5. 快表TLB
   - 是一组相联快速存储，寄存器
   - 命中时效率很高，未命中降低
   - TLB条目数在64-1024之间，程序的地址访问存在局部性

### （六）分段存储管理方式

1. 程序由若干部分（段）组成，将各段分别放入内存
2. 进程的段表，存在PCB
3. 段表寄存器变换地址
4. 段页结合
   - 
